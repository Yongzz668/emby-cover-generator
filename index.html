const HTML = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="emby-nginx助手，智能媒体服务器配置工具，支持115网盘无缝对接，自动化STRM生成。">
    <meta name="keywords" content="emby-nginx, 媒体服务器, 115网盘, STRM, Emby, Jellyfin">
    <title>emby-nginx助手 - 网盘媒体服务器解决方案</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;color:#1d1d1f;background:#2a2f3a;line-height:1.6;transition:background 0.3s, color 0.3s}nav{background:#1e252f;backdrop-filter:blur(20px);position:fixed;width:100%;z-index:100;padding:10px 0;transition:background 0.3s}.nav-container{max-width:980px;margin:0 auto;padding:0 22px;display:flex;align-items:center}.nav-logo{height:40px;margin-right:20px;transition:opacity .3s}.nav-logo img{height:100%;object-fit:contain}.nav-logo.error{opacity:.5}.nav-logo.error::after{content:"Logo 加载失败";font-size:12px;color:#a3c9d6;margin-left:10px}.nav-list{display:flex;justify-content:space-between;list-style:none;height:44px;align-items:center;flex-grow:1}.nav-list li a{color:#a3c9d6;text-decoration:none;font-size:12px;opacity:.8;transition:opacity .3s}.nav-list li a:hover{opacity:1;color:#4ecdc4}@media (max-width:600px){.nav-list{display:none}.nav-container{justify-content:center}.nav-logo{height:30px}}main{padding-top:64px}.hero-section{text-align:center;padding:80px 0 60px;background:linear-gradient(135deg,#2e3a46,#4ecdc4);color:#fff;transition:background 0.3s}.hero-title{font-size:56px;font-weight:600;margin-bottom:6px;background:linear-gradient(45deg,#4ecdc4,#45b7c0);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.hero-subtitle{font-size:28px;font-weight:400;margin-bottom:15px;color:#d1e8e2;transition:color 0.3s}.hero-links a{color:#45b7c0;text-decoration:none;margin:0 15px;font-weight:500}.hero-links a:hover{text-decoration:underline;color:#4ecdc4}.feature-section{max-width:980px;margin:0 auto;padding:60px 22px;background:#2e3a46;transition:background 0.3s, box-shadow 0.3s}.section-title{font-size:40px;font-weight:600;text-align:center;margin-bottom:40px;color:#4ecdc4}.feature-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:30px}.feature-card{background:#34495e;border-radius:18px;padding:30px;box-shadow:0 5px 20px rgba(0,0,0,.2);transition:transform .3s, background 0.3s, box-shadow 0.3s;color:#d1e8e2}.feature-card:hover{transform:translateY(-5px);background:#3d566e}.feature-icon{font-size:32px;margin-bottom:15px;color:#4ecdc4}.feature-title{font-size:24px;font-weight:600;margin-bottom:15px;color:#fff;transition:color 0.3s}.feature-desc{color:#a3c9d6;font-size:17px;transition:color 0.3s}.code-container{position:relative;margin:30px 0}.code-section{background:#2a2f3a;color:#d1e8e2;padding:20px;border-radius:8px;font-family:Menlo,Monaco,Consolas,"Courier New",monospace;font-size:14px;line-height:1.5;overflow-x:auto;transition:background 0.3s, color 0.3s}.copy-btn{position:absolute;top:10px;right:10px;background:#34495e;color:#d1e8e2;border:none;padding:5px 10px;border-radius:4px;cursor:pointer;font-size:12px;opacity:.7;transition:all .3s}.copy-btn:hover{opacity:1;background:#4ecdc4}.copy-success{background:#45b7c0!important}.guide-section{max-width:980px;margin:0 auto;padding:60px 22px;background:#2e3a46;transition:background 0.3s, box-shadow 0.3s}.guide-step{margin-bottom:40px}.step-title{font-size:28px;font-weight:600;margin-bottom:20px;color:#4ecdc4}.info-list{list-style-type:none;color:#a3c9d6;font-size:17px;line-height:1.8;margin:20px 0;transition:color 0.3s}.info-list li{margin-bottom:10px;position:relative;padding-left:20px}.info-list li:before{content:"•";color:#4ecdc4;position:absolute;left:0}footer{background:#1e252f;color:#a3c9d6;font-size:12px;padding:30px 0;text-align:center;transition:background 0.3s, color 0.3s}.footer-links a{color:#45b7c0;text-decoration:none;margin:0 10px}.footer-links a:hover{text-decoration:underline;color:#4ecdc4}.qrcode-container{text-align:center;margin:30px 0}.qrcode-img{max-width:200px;border:5px solid #4ecdc4;border-radius:10px;margin:0 auto}.qrcode-desc{color:#a3c9d6;margin-top:10px;font-size:16px;transition:color 0.3s}.manual-section{max-width:980px;margin:0 auto;padding:60px 22px;background:#2e3a46;transition:background 0.3s, box-shadow 0.3s}.manual-card{background:#34495e;border-radius:18px;padding:30px;margin-bottom:30px;transition:background 0.3s, box-shadow 0.3s}.manual-card h3{color:#4ecdc4;font-size:24px;margin-bottom:15px;transition:color 0.3s}.manual-card p{margin-bottom:15px;color:#d1e8e2;transition:color 0.3s}.manual-card ul{margin:15px 0;padding-left:20px;transition:color 0.3s}.manual-card ul li{margin-bottom:10px;color:#a3c9d6;transition:color 0.3s}.manual-card ul li:before{content:"•";color:#4ecdc4;margin-right:8px}

        /* 高亮主题样式 */
        body.light-mode {
            background: #f5f7fa;
            color: #333;
        }

        .light-mode nav {
            background: #ffffff;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .light-mode .nav-list li a {
            color: #555;
        }

        .light-mode .hero-section {
            background: linear-gradient(135deg, #e0f7fa, #b2ebf2);
            color: #333;
        }

        .light-mode .hero-title {
            background: linear-gradient(45deg, #00bcd4, #00838f);
            -webkit-background-clip: text;
        }

        .light-mode .hero-subtitle {
            color: #555;
        }

        .light-mode .feature-section,
        .light-mode .guide-section,
        .light-mode .manual-section {
            background: #ffffff;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.05);
        }

        .light-mode .feature-card {
            background: #f5f5f5;
            color: #333;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
        }

        .light-mode .feature-card:hover {
            background: #e0e0e0;
        }

        .light-mode .feature-title {
            color: #00796b;
        }

        .light-mode .feature-desc {
            color: #666;
        }

        .light-mode .code-section {
            background: #f0f0f0;
            color: #333;
        }

        .light-mode footer {
            background: #e0e0e0;
            color: #555;
        }

        .light-mode .info-list,
        .light-mode .qrcode-desc,
        .light-mode .manual-card p,
        .light-mode .manual-card ul li {
            color: #666;
        }

        /* 详细使用说明模块的浅色模式样式 */
        .light-mode .manual-section {
            background: #f9f9f9;
        }

        .light-mode .manual-card {
            background: #ffffff;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.05);
        }

        .light-mode .manual-card h3 {
            color: #00838f;
        }

        .light-mode .manual-card p {
            color: #555;
        }

        .light-mode .manual-card ul li {
            color: #666;
        }

        .light-mode .manual-card ul li:before {
            color: #00bcd4;
        }

        /* 主题切换按钮样式 */
        .theme-switcher {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #4ecdc4;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            border: none;
            font-size: 20px;
            transition: all 0.3s;
        }

        .light-mode .theme-switcher {
            background: #00bcd4;
        }

        /* 新增样式：配合工具部分 */
        .tools-section {
            max-width: 980px;
            margin: 0 auto;
            padding: 60px 22px;
            background: #2e3a46;
            transition: background 0.3s, box-shadow 0.3s;
        }

        .toggle-tools {
            display: inline-block;
            background: #4ecdc4;
            color: white;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.3s;
            border: none;
            font-size: 16px;
        }

        .toggle-tools:hover {
            background: #45b7c0;
            transform: translateY(-2px);
        }

        .tools-content {
            display: none;
            overflow: hidden;
            transition: all 0.3s;
        }

        .tools-content.show {
            display: block;
        }

        /* TG图标样式 */
        .tg-icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2345b7c0' d='M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.14-.26.26-.429.26l.213-3.053 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z'/%3E%3C/svg%3E");
            background-size: contain;
            vertical-align: middle;
            margin-right: 5px;
        }

        .light-mode .tg-icon {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%2300838f' d='M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.14-.26.26-.429.26l.213-3.053 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z'/%3E%3C/svg%3E");
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="nav-logo">
                <img src="https://cdn.jsdelivr.net/gh/Yongzz668/image@main/assets/IMG_8885.jpeg" alt="emby-nginx助手 Logo" onload="this.parentElement.classList.remove('error')" onerror="this.parentElement.classList.add('error')">
            </div>
            <ul class="nav-list">
                <li><a href="#features">核心功能</a></li>
                <li><a href="#deploy">部署指南</a></li>
                <li><a href="#tools">配合工具</a></li>
                <li><a href="#manual">使用说明</a></li>
                <li><a href="#structure">STRM结构</a></li>
                <li><a href="#contact">联系我们</a></li>
            </ul>
        </div>
    </nav>
    
    <main>
        <section class="hero-section">
            <h1 class="hero-title">emby-nginx助手</h1>
            <h2 class="hero-subtitle">智能媒体服务器配置平台 · 115网盘无缝对接</h2>
            <div class="hero-links">
                <a href="#deploy">立即部署 →</a>
                <a href="https://docs.qq.com/doc/DTHVTcHRwb3pJdk1D" target="_blank" rel="noopener noreferrer">教程文档 →</a>
                <a href="https://t.me/Embynginx" target="_blank" rel="noopener noreferrer"><span class="tg-icon"></span>Telegram群 →</a>
            </div>
        </section>
        
        <section class="feature-section" id="features">
            <h2 class="section-title">核心功能</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">⚡</div>
                    <h3 class="feature-title">自动化配置</h3>
                    <p class="feature-desc">集成STRM文件自动生成与302直链提取，扫码115二维码即可快速登录，自动获取Cookie，反代获取115网盘或Alist挂载资源直链。</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🔍</div>
                    <h3 class="feature-title">实时监控</h3>
                    <p class="feature-desc">实时检测115网盘文件变动，自动同步生成或删除STRM文件，任何整理操作即时反馈到Emby媒体库。</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">📱</div>
                    <h3 class="feature-title">多平台支持</h3>
                    <p class="feature-desc">完美适配Emby、Jellyfin、极影视，以及芝度、绿联、Infuse、Vidhub等主流播放器。</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🎬</div>
                    <h3 class="feature-title">媒体信息获取</h3>
                    <p class="feature-desc">自动获取最新媒体信息并生成STRM，支持中文简体字幕自动下载。</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🤖</div>
                    <h3 class="feature-title">微信机器人</h3>
                    <p class="feature-desc">企业微信Webhook通知，STRM生成/更新提醒，Cookie失效自动提醒并重新生成二维码。</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">☁️</div>
                    <h3 class="feature-title">WebDAV支持</h3>
                    <p class="feature-desc">通过5002端口开启WebDAV服务，支持芝度、Infuse等播放器直接刮削封面并在线播放。</p>
                </div>
            </div>
        </section>
        
        <section class="guide-section" id="deploy">
            <h2 class="section-title">一键部署</h2>
            <div class="guide-step">
                <h3 class="step-title">Docker Run 方式</h3>
                <div class="code-container">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
                    <div class="code-section">
<pre>docker run -d \
  --name emby-nginx \
  -p 7001:7001 \
  -p 8021:8001 \
  -p 9527:9527 \
  -p 5002:5002 \
  -v /volume1/emby-nginx/strm:/strm \
  -v /volume1/emby-nginx/backup:/app/backup \
  --network bridge \
  --restart unless-stopped \
  yantaocheng/emby-nginx:latest</pre>
                    </div>
                </div>
            </div>
            <div class="guide-step">
                <h3 class="step-title">Docker Compose 方式</h3>
                <div class="code-container">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
                    <div class="code-section">
<pre>version: '3'
services:
  emby-nginx:
    image: yantaocheng/emby-nginx:latest
    container_name: emby-nginx
    restart: unless-stopped
    ports:
      - "7001:7001"
      - "8021:8001"
      - "9527:9527"
      - "5002:5002"
    volumes:
      - "/volume1/emby-nginx/strm:/strm"
      - "/volume1/emby-nginx/backup:/app/backup"
    network_mode: bridge</pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- 新增配合工具部分 -->
        <section class="tools-section" id="tools">
            <h2 class="section-title">配合工具</h2>
            <button class="toggle-tools" onclick="toggleTools()">显示/隐藏配合工具</button>
            
            <div class="tools-content" id="toolsContent">
                <div class="guide-step">
                    <h3 class="step-title">Emby 服务器部署</h3>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <div class="code-section">
<pre>docker run -d \
--name embyserver \
--network host \
-e TZ=Asia/Shanghai \
-e UID=0 \
-e GID=0 \
-e GIDLIST=100 \
-v /volume1/docker/config:/config \
-v /volume1/emby-nginx/strm:/strm \
--restart always \
amilys/embyserver:latest</pre>
                        </div>
                    </div>
                </div>
                
                <div class="guide-step">
                    <h3 class="step-title">Docker Copilot 部署</h3>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyCode(this)">复制</button>
                        <div class="code-section">
<pre>docker run -d \
 --name dockercopilot \
 --restart always \
 --privileged \
 --network bridge \
 -p 12712:12712 \
 -v /var/run/docker.sock:/var/run/docker.sock \
 -v /volume1/data:/data \
 -e TZ=Asia/Shanghai \
 -e DOCKER_HOST=unix:///var/run/docker.sock \
 -e secretKey=aa123456 \
 0nlylty/dockercopilot:latest</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="manual-section" id="manual">
            <h2 class="section-title">详细使用说明</h2>
            
            <div class="manual-card">
                <h3>安装与登录</h3>
                <p>首先通过docker命令拉取或compose命令部署容器。成功运行后，在浏览器输入局域网IP:9527访问后台。</p>
                <ul>
                    <li>默认用户名和密码均为admin</li>
                    <li>登录后建议慎重修改密码（本地存储机制无法找回密码）</li>
                </ul>
            </div>
            
            <div class="manual-card">
                <h3>仪表盘功能</h3>
                <p>这是通过Emby插件Playback Reporting实现的观影数据可视化界面。</p>
                <ul>
                    <li>当成功显示饼状图时，表明Emby-Nginx与Emby服务器的反向代理连接正常</li>
                    <li>若无数据显示，需检查：1）插件是否安装 2）网络连接 3）反代配置</li>
                </ul>
            </div>
            
            <div class="manual-card">
                <h3>用户信息管理</h3>
                <ul>
                    <li>UUID是设备生成的唯一标识码，设备不变时即使升级版本也不会改变</li>
                    <li>激活码需将UUID发送给开发者获取，同一UUID可重复激活</li>
                    <li>修改后的用户名密码无法找回只能重装，务必妥善保管</li>
                </ul>
            </div>
            
            <div class="manual-card">
                <h3>Cookie配置</h3>
                <p>支持两种配置方式：</p>
                <ul>
                    <li><strong>115网盘：</strong>扫描非主用端的二维码获取Cookie，可配置多个实现轮询调用（避免风控）</li>
                    <li><strong>Alist：</strong>需填写已部署的Alist地址（如http://192.168.1.100:5244）及管理员账号密码。注意Alist需保持在线状态且两处签名已经关闭</li>
                </ul>
            </div>
            
            <div class="manual-card">
                <h3>Strm文件生成</h3>
                <p>提供三种生成模式：</p>
                <ul>
                    <li><strong>本地Strm：</strong>实时监控115网盘变化，生成到/local目录供Emby挂载，支持定时全量生成（cron表达式）</li>
                    <li><strong>外网Strm：</strong>通过5002端口WebDAV提供/online目录，适用芝杜/Infuse等播放器（有Emby时建议直接用Emby）</li>
                    <li><strong>Alist Strm：</strong>需确保Alist挂载路径与生成路径完全一致，且关闭Alist的两处"签名"功能</li>
                </ul>
            </div>
            
            <div class="manual-card">
                <h3>媒体服务器代理</h3>
                <p><strong>Emby反代配置：</strong></p>
                <ul>
                    <li>必须填写准确的本地地址（如http://局域网地址:8096）和API密钥</li>
                    <li>播放端口从原生8096变为直链端口7001</li>
                    <li>支持多个Emby配置（通过+号添加）</li>
                </ul>
                
                <p><strong>飞牛影视代理：</strong></p>
                <ul>
                    <li>需配合CD2挂载使用（因飞牛不支持Strm解析）</li>
                    <li>播放端口从8005变为直链端口8021</li>
                </ul>
            </div>
            
            <div class="manual-card">
                <h3>实用工具</h3>
                <ul>
                    <li><strong>封面生成器：</strong>在Emby完成刮削后，可立即或定时生成高清封面</li>
                    <li><strong>Strm批处理：</strong>支持批量删除错误文件，或全局替换strm内路径前缀</li>
                </ul>
            </div>
            
            <div class="manual-card">
                <h3>消息通知系统</h3>
                <p>通过企业微信机器人Webhook接收：</p>
                <ul>
                    <li>实时系统日志</li>
                    <li>Emby事件通知（入库/播放/暂停）</li>
                    <li>特殊机制：利用Emby入库通知触发媒体文件信息追更探测</li>
                </ul>
            </div>
            
            <div class="manual-card">
                <h3>右上角功能区</h3>
                <ul>
                    <li><strong>教程文档：</strong>完整使用指南和问题解决方案</li>
                    <li><strong>版本信息：</strong>查看当前版本号和更新日志</li>
                    <li><strong>运行日志：</strong>所有操作记录的集中显示，错误排查时建议：
                        <ul>
                            <li>过滤ERROR级别日志</li>
                            <li>按时间戳定位问题</li>
                        </ul>
                    </li>
                </ul>
            </div>
            
            <div class="manual-card">
                <h3>关键注意事项</h3>
                <ul>
                    <li>直链播放必须使用反代端口播放（Emby用7001，飞牛用8021）</li>
                    <li>Alist网盘挂载路径必须与Strm生成路径完全一致（包括大小写和斜杠方向）</li>
                    <li>重要操作前建议备份/backup目录</li>
                    <li>大量Strm生成建议在系统空闲时定时执行</li>
                </ul>
            </div>
        </section>
        
        <section class="guide-section" id="structure">
            <h2 class="section-title">STRM配置说明</h2>
            <div class="guide-step">
                <h3 class="step-title">端口映射说明</h3>
                <ul class="info-list">
                    <li><strong>9527:9527</strong> - 管理后台访问端口，STRM文件外网访问的"前缀通道"</li>
                    <li><strong>7001:7001</strong> - 反向代理Emby/Jellyfin的8096端口，实现302直链</li>
                    <li><strong>5002:5002</strong> - WebDAV服务端口，支持播放器直接挂载</li>
                    <li><strong>8021:8001</strong> - 飞牛影视系统专用直链反代端口</li>
                </ul>
            </div>
            <div class="guide-step">
                <h3 class="step-title">文件夹说明</h3>
                <ul class="info-list">
                    <li><strong>/strm/local</strong> - 本机Emby/Jellyfin容器映射的STRM文件目录</li>
                    <li><strong>/strm/online</strong> - 外部播放器使用的STRM文件，通过WebDAV挂载</li>
                    <li><strong>/strm/alist</strong> - Alist挂载网盘生成的STRM文件，适用于非115网盘用户</li>
                </ul>
            </div>
        </section>
        
        <section class="guide-section" id="contact">
            <h2 class="section-title">获取支持</h2>
            <div class="qrcode-container">
                <img src="https://cdn.jsdelivr.net/gh/Yongzz668/image@main/assets/IMG_8887.jpeg" alt="微信公众号二维码" class="qrcode-img">
                <p class="qrcode-desc">扫码关注微信公众号获取技术支持</p>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <p style="font-size: 18px; color: #a3c9d6; margin-bottom: 20px;">通过微信公众号: <strong>emby-nginx助手</strong> 发送"激活码"获取购买方式</p>
                <p style="font-size: 18px; color: #a3c9d6; margin-bottom: 30px;">记得发送UUID至: <a href="mailto:yantaocheng@outlook.com" style="color: #45b7c0;">yantaocheng@outlook.com</a> 生成激活码</p>
                <p style="font-size: 18px; color: #a3c9d6;">
                    <a href="https://t.me/Embynginx" target="_blank" rel="noopener noreferrer" style="color: #45b7c0; text-decoration: none;">
                        <span class="tg-icon"></span> 加入Telegram交流群
                    </a>
                </p>
            </div>
        </section>
    </main>
    
    <footer>
        <p>© 2025 emby-nginx助手 保留解释权利</p>
        <div class="footer-links">
            <a href="https://docs.qq.com/doc/DTHVTcHRwb3pJdk1D" target="_blank" rel="noopener noreferrer">文档中心</a>
            <a href="mailto:yantaocheng@outlook.com">技术支持</a>
            <a href="https://t.me/Embynginx" target="_blank" rel="noopener noreferrer">Telegram群</a>
        </div>
    </footer>

    <button class="theme-switcher" id="themeToggle">☀️</button>

    <script>
        // 主题切换功能
        document.addEventListener('DOMContentLoaded', function() {
            const themeToggle = document.getElementById('themeToggle');
            const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
            
            // 检查本地存储或系统偏好
            const currentTheme = localStorage.getItem('theme') || 
                                (prefersDarkScheme.matches ? 'dark' : 'light');
            
            if (currentTheme === 'light') {
                document.body.classList.add('light-mode');
                themeToggle.textContent = '🌙';
            } else {
                themeToggle.textContent = '☀️';
            }
            
            // 切换主题
            themeToggle.addEventListener('click', function() {
                const isLight = document.body.classList.toggle('light-mode');
                localStorage.setItem('theme', isLight ? 'light' : 'dark');
                themeToggle.textContent = isLight ? '🌙' : '☀️';
            });

            // 复制代码功能
            function copyCode(button) {
                const codeSection = button.nextElementSibling;
                const range = document.createRange();
                range.selectNode(codeSection);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        button.textContent = '已复制!';
                        button.classList.add('copy-success');
                        setTimeout(() => {
                            button.textContent = '复制';
                            button.classList.remove('copy-success');
                        }, 2000);
                    }
                } catch (err) {
                    console.error('复制失败: ', err);
                    button.textContent = '复制失败';
                    alert('复制失败，请手动复制！');
                }
                
                window.getSelection().removeAllRanges();
            }

            // 为所有代码块添加复制按钮
            const codeSections = document.querySelectorAll('.code-section');
            codeSections.forEach(section => {
                if (!section.parentNode.classList.contains('code-container')) {
                    const container = document.createElement('div');
                    container.className = 'code-container';
                    section.parentNode.insertBefore(container, section);
                    container.appendChild(section);
                    
                    const btn = document.createElement('button');
                    btn.className = 'copy-btn';
                    btn.textContent = '复制';
                    btn.onclick = function() { copyCode(this); };
                    btn.onkeydown = function(e) { if (e.key === 'Enter') copyCode(this); };
                    container.insertBefore(btn, section);
                }
            });

            // 检查logo加载状态
            const logoImg = document.querySelector('.nav-logo img');
            if (logoImg && logoImg.complete && logoImg.naturalHeight === 0) {
                logoImg.parentElement.classList.add('error');
            }
        });

        // 新增：配合工具显示/隐藏功能
        function toggleTools() {
            const toolsContent = document.getElementById('toolsContent');
            toolsContent.classList.toggle('show');
        }
    </script>
</body>
</html>`;

addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

async function handleRequest(request) {
  const url = new URL(request.url)
  
  if (url.pathname === '/favicon.ico') {
    return new Response(null, { status: 204 })
  }
  
  if (url.pathname !== '/') {
    return Response.redirect(url.origin, 301)
  }
  
  return new Response(HTML, {
    headers: {
      'content-type': 'text/html;charset=UTF-8',
      'Cache-Control': 'public, max-age=3600',
      'X-Frame-Options': 'DENY',
      'X-Content-Type-Options': 'nosniff'
    }
  })
}